name: Terraform CI Build
on:
    push:
        branches: [features/*, main]
    pull_request: 
        branches: [main]
jobs:
    Version:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v3
              name: Checkout
              with:
                fetch-depth: 0
            - uses: gittools/actions/gitversion/setup@v0
              name: Install Giversion 5.x
              with:
                versionSpec: '5.x'
            - uses: gittools/actions/gitversion/execute@v0
              name: Determine Version
              with:
                useConfigFile: true
                configFilePath: '.gitversion'

    Terraform:
        runs-on: ubuntu-latest
        name: Terraform Cheks
        defaults:
          run:
            working-directory: src

        steps:
          - uses: actions/checkout@v3
            name: Checkout
          - uses: hashicorp/setup-terraform@v3
            with:
              terraform_version: "1.7.2-1"
          - run: terraform init -backend=false
            name: Terrform Init
          - run: terraform fmt -check
            name: Terraform format check
            continue-on-error: true
          - run: terraform validate -no-color
            name: Terraform validate